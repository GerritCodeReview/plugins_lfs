{
  "comments": [
    {
      "key": {
        "uuid": "081c2bae_e66c3e35",
        "filename": "/COMMIT_MSG",
        "patchSetId": 8
      },
      "lineNbr": 11,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2016-08-23T10:55:58Z",
      "side": 1,
      "message": "Thinking again about this setup, for some scenarios it may not be optimal. \nBy keeping the maxObjectSize in refs/meta/config:project.config, project owners can increase their object size limit at their will.\n\nFor a typical corporate Gerrit setup (one large instance with thousands of projects) we usually want to keep important parameters under control of Gerrit admins. The lfs.maxObjectSize is one such critical parameter. Increasing it over a globally set limit should be done by an admin.",
      "range": {
        "startLine": 9,
        "startChar": 0,
        "endLine": 11,
        "endChar": 24
      },
      "revId": "0f2960b45b4ecc73a537fd0e290a54d97cdbc6d8",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e8d27743_b5eb60a7",
        "filename": "/COMMIT_MSG",
        "patchSetId": 8
      },
      "lineNbr": 11,
      "author": {
        "id": 1011123
      },
      "writtenOn": "2016-08-23T11:05:18Z",
      "side": 1,
      "message": "This sounds reasonable.\n\nDo you mean to introduce another setting, something like globalMaxObjectSize, and have that only configurable on the All-Projects git?\n\nOr replace this setting with one that\u0027s set globally on the All-Projects and can\u0027t be set per project?",
      "parentUuid": "081c2bae_e66c3e35",
      "range": {
        "startLine": 9,
        "startChar": 0,
        "endLine": 11,
        "endChar": 24
      },
      "revId": "0f2960b45b4ecc73a537fd0e290a54d97cdbc6d8",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "682da7d5_49556152",
        "filename": "/COMMIT_MSG",
        "patchSetId": 8
      },
      "lineNbr": 11,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2016-08-23T12:06:34Z",
      "side": 1,
      "message": "Ideally, I would like to keep the flexibility of setting the limit on per-project basis. Just it should only be possible by an admin to increase the limit for a project.\n\nAt the moment I am undecided on how to implement that but will try to propose something.",
      "parentUuid": "e8d27743_b5eb60a7",
      "range": {
        "startLine": 9,
        "startChar": 0,
        "endLine": 11,
        "endChar": 24
      },
      "revId": "0f2960b45b4ecc73a537fd0e290a54d97cdbc6d8",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "081c2bae_e6cefe2e",
        "filename": "/COMMIT_MSG",
        "patchSetId": 8
      },
      "lineNbr": 11,
      "author": {
        "id": 1025452
      },
      "writtenOn": "2016-08-23T17:43:09Z",
      "side": 1,
      "message": "We have internally discussed it and agreed that lfs.config should stay but if it was part of project.config one could easily configure it through ProjectConfigEntry and had GUI generated for it @ particular project level with inheritance",
      "parentUuid": "682da7d5_49556152",
      "range": {
        "startLine": 9,
        "startChar": 0,
        "endLine": 11,
        "endChar": 24
      },
      "revId": "0f2960b45b4ecc73a537fd0e290a54d97cdbc6d8",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "081c2bae_c6cb021d",
        "filename": "/COMMIT_MSG",
        "patchSetId": 8
      },
      "lineNbr": 11,
      "author": {
        "id": 1025452
      },
      "writtenOn": "2016-08-23T17:51:17Z",
      "side": 1,
      "message": "Another idea is to mimic ProjectConfigEntry in PluginConfigEntry and have it visible @project configuration but stored in plugin specific file in refs/meta/config as it it right now but t his requires more work...",
      "parentUuid": "081c2bae_e6cefe2e",
      "range": {
        "startLine": 9,
        "startChar": 0,
        "endLine": 11,
        "endChar": 24
      },
      "revId": "0f2960b45b4ecc73a537fd0e290a54d97cdbc6d8",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "68712757_49e6e1dd",
        "filename": "/COMMIT_MSG",
        "patchSetId": 8
      },
      "lineNbr": 11,
      "author": {
        "id": 1025452
      },
      "writtenOn": "2016-08-24T11:29:59Z",
      "side": 1,
      "message": "I am actually looking at it in my spare cycles but if it is dead end from your perspective would like to know earlier ;)",
      "parentUuid": "081c2bae_c6cb021d",
      "range": {
        "startLine": 9,
        "startChar": 0,
        "endLine": 11,
        "endChar": 24
      },
      "revId": "0f2960b45b4ecc73a537fd0e290a54d97cdbc6d8",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "4862a390_c8f16f97",
        "filename": "/COMMIT_MSG",
        "patchSetId": 8
      },
      "lineNbr": 11,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2016-08-24T12:08:42Z",
      "side": 1,
      "message": "Sorry for waiting on my input... it has been very busy here yesterday and today.\n\nLet\u0027s first agree about goals/requirements:\n* admins must be able to set a global lfs.maxObjectSize that is valid for all projects using LFS\n* admins must be able to change lfs.maxObjectSize for a single project. It must be possible to increase the maxObjectSize over the inherited maxObjectSize for a single project.\n* project owners should be able to change lfs.maxObjectSize for their project (Notice the \"should\" instead of \"must\").\n* assuming project owners are allowed to set lfs.maxObjectSize for their project(s), admins must be able to set an upper limit for lfs.maxObjectSize which project owners cannot exceed\n\nDo you agree?",
      "parentUuid": "68712757_49e6e1dd",
      "revId": "0f2960b45b4ecc73a537fd0e290a54d97cdbc6d8",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "886c9b82_ea21c707",
        "filename": "/COMMIT_MSG",
        "patchSetId": 8
      },
      "lineNbr": 11,
      "author": {
        "id": 1011123
      },
      "writtenOn": "2016-08-24T12:21:07Z",
      "side": 1,
      "message": "The requirements seem reasonable from a usage point of view.\n\nOne idea I had for the global max size is to put that in the gerrit.config section under [lfs], and implement logic to make sure the value defined in the project doesn\u0027t exceed it.\n\nI\u0027m just not sure how in the implementation we can distinguish who is doing the setting in the project config.  Perhaps possible by implementing a validation listener that intercepts the commit and checks the lfs.config before it\u0027s accepted?",
      "parentUuid": "4862a390_c8f16f97",
      "revId": "0f2960b45b4ecc73a537fd0e290a54d97cdbc6d8",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "4862a390_e8f6b38c",
        "filename": "/COMMIT_MSG",
        "patchSetId": 8
      },
      "lineNbr": 11,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2016-08-24T13:42:14Z",
      "side": 1,
      "message": "\u003e The requirements seem reasonable from a usage point of view.\n \u003e \n \u003e One idea I had for the global max size is to put that in the\n \u003e gerrit.config section under [lfs], and implement logic to make sure\n \u003e the value defined in the project doesn\u0027t exceed it.\n\nBut only for project owners, admins should be able to set a value which exceeds the limit.\n\n \u003e I\u0027m just not sure how in the implementation we can distinguish who\n \u003e is doing the setting in the project config.  Perhaps possible by\n \u003e implementing a validation listener that intercepts the commit and\n \u003e checks the lfs.config before it\u0027s accepted?\n\nSomething like that could work I think, but would likely be ugly. Not only would we have to check the content of lfs.config against the current user we would also likely have to compute the diff of the commit and check if it contains lfs.maxObjectSize in it. Why? Assume an admin changes the lfs.maxObjectSize over the global limit for a project. After that a project owner wouldn\u0027t be able to push a new version of the config file if the validation would check the whole content. Instead the validation has to only validate the diff. So, this approach is not easy IMO.\n\nTherefore, I would like to question the decision of keeping the lfs.maxObjectSize in the project\u0027s refs/meta/config branch.\nWhile it simplifies the implementation (of the UI) a bit, it also makes it hard to ensure\nprotection of Gerrit server and LFS server resources from careless project owners.\n\nIn the quota plugin we took a different approach for configuration [1]. There, all limits are specified in the $GERRIT/etc/quota.config file. Given a project name we scan the \"quota\" sections top-down and the first one that matches the project name applies to this project. This way, we can handle the default for all project by [quota \"*\"] and we can define different quota for a project by placing another more specific section above. Using the same approach for the lfs plugin, if we want a default limit of 50m and an increased limit of 100m for a project \"A\" we could have:\n\n  [limit \"A\"]\n    maxObjectSize \u003d 100m\n  [limit \"*\"]\n    maxObjectSize \u003d 50m\n\nin plugin\u0027s specific $GERRIT/etc/lfs.config file.\n\nImplementing this approach would be significantly simpler than implementing commit validation listeners, computing diffs, etc...\n\nI am curious about your opinions.\n\n[1] https://gerrit.googlesource.com/plugins/quota/+/refs/heads/master/src/main/resources/Documentation/config.md",
      "parentUuid": "886c9b82_ea21c707",
      "revId": "0f2960b45b4ecc73a537fd0e290a54d97cdbc6d8",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "683927b8_298a4d15",
        "filename": "/COMMIT_MSG",
        "patchSetId": 8
      },
      "lineNbr": 11,
      "author": {
        "id": 1011123
      },
      "writtenOn": "2016-08-25T01:49:26Z",
      "side": 1,
      "message": "I agree with implementing the global max setting in $GERRIT/etc/$PLUGIN.config.  This will mean that only admins can set it (if we assume that only admins have access to the server\u0027s file system).\n\nIt\u0027s still not clear how it will be possible to distinguish between project owners or admins making changes to the project level config. The easiest way would be to restrict access to refs/meta/config but that might not always be the best way as it will potentially prevent other changes from being made.",
      "parentUuid": "4862a390_e8f6b38c",
      "revId": "0f2960b45b4ecc73a537fd0e290a54d97cdbc6d8",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "2861efbb_b7a4e89f",
        "filename": "/COMMIT_MSG",
        "patchSetId": 8
      },
      "lineNbr": 11,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2016-08-25T08:07:37Z",
      "side": 1,
      "message": "\u003e It\u0027s still not clear how it will be possible to distinguish between\n \u003e project owners or admins making changes to the project level\n \u003e config. The easiest way would be to restrict access to\n \u003e refs/meta/config but that might not always be the best way as it\n \u003e will potentially prevent other changes from being made.\n\nThis is why I proposed to maintain all limits in the $GERRIT/etc/$PLUGIN.config file including those per-project limits.\nIn that case only admins can maintain the limits. An example is given in my previous comment.\n\nIf we still want to allow project owners to change maxObjectSize for their project, then this should go into the refs/meta/config branch. Plugin code then must ensure that the maxObjectSize in refs/meta/config doesn\u0027t exceed the limit set by admins in the $GERRIT/etc/$PLUGIN.config. Effectively, this means that project owners can only *decrease* the maxObjectSizeLimit for their project.\nTherefore, I wonder if it is worth the effort to support this scenario at all?\n\nAt the moment, I think that having all limits set and maintained by admins in $GERRIT/etc/$PLUGIN.config is enough.",
      "parentUuid": "683927b8_298a4d15",
      "revId": "0f2960b45b4ecc73a537fd0e290a54d97cdbc6d8",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    }
  ]
}